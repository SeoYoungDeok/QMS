
## 1) 페이지 개요
- **페이지명**: 실적 등록 (Performance Entry)
- **목적**: 사내 실적 · 수입검사 실적 등록(단일/일괄), 조회 및 검증
- **권한**
  - **게스트(0)**: 조회 전용(템플릿 다운로드·예시 보기 가능, 저장 불가)
  - **실무자(1)**: 모든 실적 CRUD
  - **관리자(2)**: 모든 기능 + 감사 로그 열람

---

## 2) 기능 요약

### A. 탭 구성
1) **단일 등록**  
- 유형 토글: `사내 실적(inhouse)` / `수입검사 실적(incoming)`  
- 유형별 필드 자동 전환  
- 등록 성공 시 스낵바 + 최근 등록 목록(선택)  

2) **일괄 등록**  
- CSV/XLSX 업로드, 템플릿 다운로드 제공  
- 파싱 미리보기 + 행별 검증 결과  
- 오류 행만 다운로드(.csv)  
- 트랜잭션 옵션: 전체 롤백 / 부분 저장(기본)

### B. 입력 필드

| 구분 | 필드 | 필수 | 설명 |
|---|---|---|---|
| 공통 | 실적일(`date`) | ✅ | YYYY-MM-DD |
| 공통 | 업체명(`vendor`) | ✅ | 자유입력 |
| 공통 | 품명(`product_name`) | ✅ | 자유입력 |
| 공통 | 관리번호(`control_no`) | ✅ | 중복 허용, 조회·추적용 |
| 공통 | 실적수량(`quantity`) | ✅ | 정수 ≥ 1 |
| 공통 | 생산처(`producer`) | ✅ | **모든 실적에서 필수** (예: 사내, 외주업체1, 외주업체2 …) |
| 공통 | 요일(`weekday`) | ❌ | **서버에서 자동 산출/저장** |

> 생산처는 사내 실적이라면 `"사내"`, 외주업체라면 `"외주업체1"`과 같은 값이 들어감.  
> 요일은 UI에서 읽기 전용 표시(서버 계산값).

---

### C. 검증
- `date`: 유효한 날짜  
- `quantity`: 정수 ≥ 1  
- `producer`: 모든 행에서 필수 값  
- 일괄 업로드 시 중복, 형식 오류 검증  

---

## 3) 데이터베이스 스키마 (단일 테이블)

**테이블명: `performance_records`**

| 컬럼 | 타입(예시) | 제약/설명 |
|---|---|---|
| id | BIGINT (PK, AI) | 내부 PK |
| **record_uid** | CHAR(26) (UNIQUE) | ULID (비즈니스 고유 식별자) |
| type | VARCHAR(10) | `'inhouse'` 또는 `'incoming'` |
| date | DATE | 실적일 |
| vendor | VARCHAR(100) | 업체명 |
| product_name | VARCHAR(100) | 품명 |
| control_no | VARCHAR(100) | 관리번호 (중복 허용) |
| quantity | INT | 실적수량 |
| **producer** | VARCHAR(100) | 생산처 (**모든 행 필수**) |
| weekday_code | CHAR(3) | `MON..SUN` (서버 계산) |
| created_by | BIGINT | 작성자(`users.id`) |
| created_at | DATETIME | 생성시각 |
| updated_at | DATETIME | 수정시각 |

---

## 4) API 계약

### 4.1 단일 등록
**POST** `/api/performance`

- **Request (사내 실적)**
```json
{
  "type": "inhouse",
  "date": "2025-08-24",
  "vendor": "ABC정밀",
  "product_name": "하우징-123",
  "control_no": "QMS-2025-000123",
  "quantity": 120,
  "producer": "사내"
}
```

- **Request (수입검사 실적)**
```json
{
  "type": "incoming",
  "date": "2025-08-24",
  "vendor": "XYZ가공",
  "product_name": "브래킷-9",
  "control_no": "QMS-2025-000124",
  "quantity": 60,
  "producer": "외주업체1"
}
```

- **Response (성공)**
```json
{
  "message": "created",
  "id": 101,
  "record_uid": "01J5ZC3ZQ8F9XTK3QJ7E1Q3J7R",
  "weekday": "SUN"
}
```

---

### 4.2 일괄 등록
**POST** `/api/performance/bulk`

- **Request**
```json
{
  "rows": [
    {
      "type": "inhouse",
      "date": "2025-08-24",
      "vendor": "ABC정밀",
      "product_name": "하우징-123",
      "control_no": "QMS-2025-000123",
      "quantity": 120,
      "producer": "사내"
    },
    {
      "type": "incoming",
      "date": "2025-08-24",
      "vendor": "XYZ가공",
      "product_name": "브래킷-9",
      "control_no": "QMS-2025-000124",
      "quantity": 60,
      "producer": "외주업체1"
    }
  ],
  "transaction": "partial"
}
```

- **Response (부분 성공 예시)**
```json
{
  "summary": {
    "total": 2,
    "success": 1,
    "failed": 1
  },
  "errors": [
    {
      "row_index": 1,
      "control_no": "QMS-2025-000124",
      "message": "producer is required"
    }
  ],
  "created": [
    {
      "id": 101,
      "record_uid": "01J5ZC3ZQ8F9XTK3QJ7E1Q3J7R"
    }
  ]
}
```

---

### 4.3 템플릿 다운로드
- **GET** `/api/performance/template?type=inhouse`
```
type,date,vendor,product_name,control_no,quantity,producer
inhouse,2025-08-24,ABC정밀,하우징-123,QMS-2025-000123,120,사내
```

- **GET** `/api/performance/template?type=incoming`
```
type,date,vendor,product_name,control_no,quantity,producer
incoming,2025-08-24,XYZ가공,브래킷-9,QMS-2025-000124,60,외주업체1
```

---

## 5) 권한·감사·비기능
- **권한**: 게스트(조회만), 실무자(CRUD), 관리자(CRUD+감사 로그 열람)  
- **감사 로그**: `audit_logs`에 CREATE/BULK_CREATE/UPDATE/DELETE 기록  
- **성능**: 단일 등록 < 1s, 일괄 등록 1,000행 < 10s  
- **보안**: JWT 인증, 업로드 검증, 서버에서 요일 자동 계산  

---

## 6) 마이그레이션 노트 (예시)
- `performance_records` 테이블 생성  
- `record_uid`는 서버에서 ULID 생성 후 저장(UNIQUE)  
- 기존 데이터 이관 시 `record_uid`를 일괄 생성