---
description: 포스트잇 보드 페이지를 개발하거나 메모 관리, 태그 기능을 구현할 때 참고
globs:
alwaysApply: false
---
## 라우트 (URL)

### 포스트잇 API
- `/sticky-notes/` - 포스트잇 목록 조회 (GET, 인증 필요)
- `/sticky-notes/` - 포스트잇 생성 (POST, 실무자 이상)
- `/sticky-notes/<int:pk>/` - 포스트잇 상세 조회 (GET, 인증 필요)
- `/sticky-notes/<int:pk>/` - 포스트잇 수정 (PUT/PATCH, 실무자 이상, 본인 또는 관리자)
- `/sticky-notes/<int:pk>/` - 포스트잇 삭제 (DELETE, 실무자 이상, 본인 또는 관리자, 물리삭제)
- `/sticky-notes/<int:pk>/update_position/` - 위치 빠른 업데이트 (PATCH, 실무자 이상)
- `/sticky-notes/bulk_update/` - 다중 선택 일괄 업데이트 (POST, 실무자 이상)
- `/sticky-notes/by_viewport/` - 뷰포트 영역 내 메모 조회 (GET, 인증 필요)

### 태그 API
- `/tags/` - 태그 목록 조회 (GET, 인증 필요)
- `/tags/` - 태그 생성 (POST, 실무자 이상)
- `/tags/<int:pk>/` - 태그 상세 조회 (GET, 인증 필요)
- `/tags/<int:pk>/` - 태그 수정 (PUT/PATCH, 실무자 이상)
- `/tags/<int:pk>/` - 태그 삭제 (DELETE, 관리자 이상, 물리삭제)

## 스키마 (모델)

### StickyNote 모델
**포스트잇 메모 관리**
- `note_uid` (CharField, 26자, 고유) - ULID 기반 비즈니스 식별자
- `author` (ForeignKey to User, CASCADE) - 작성자
- `content` (TextField) - 메모 내용
- `importance` (CharField, 10자) - 중요도
  - low: 낮음
  - medium: 중간
  - high: 높음
- `color` (CharField, 20자) - 메모지 색상
  - yellow: 노란색
  - blue: 파란색
  - pink: 분홍색
  - green: 초록색
  - purple: 보라색
  - gray: 회색
- `x` (FloatField, 기본값 0) - X좌표
- `y` (FloatField, 기본값 0) - Y좌표
- `width` (FloatField, 기본값 220) - 너비
- `height` (FloatField, 기본값 160) - 높이
- `z_index` (IntegerField, 기본값 1) - 쌓임 순서
- `is_locked` (BooleanField, 기본값 False) - 잠금 여부
- `tags` (ManyToManyField to Tag, through NoteTag) - 연결된 태그 목록
- `created_at`, `updated_at` - 타임스탬프

**인덱스**:
- idx_notes_author: author 필드
- idx_notes_importance: importance 필드
- idx_notes_created: created_at 필드
- idx_notes_pos: (x, y) 복합 인덱스

### Tag 모델
**태그 마스터 테이블**
- `name` (CharField, 50자, 고유) - 태그명
- `color` (CharField, 20자, null 허용) - 태그 색상 (hex 코드)
- `created_at` - 생성시각

### NoteTag 모델
**포스트잇-태그 매핑 테이블 (다대다 중간 테이블)**
- `note` (ForeignKey to StickyNote, CASCADE) - 메모
- `tag` (ForeignKey to Tag, CASCADE) - 태그

**제약조건**:
- (note, tag) 조합 유일성 제약

## 서비스 함수

### StickyNoteViewSet
- `list()` - 포스트잇 목록 조회 (관리자는 전체, 실무자/게스트는 본인 메모만)
  - 필터링 지원:
    - `?query=검색어` - 메모 내용 또는 UID 검색
    - `?tag_ids=1,2,3` - 태그 ID 필터링 (쉼표 구분)
    - `?importance=low|medium|high` - 중요도 필터링
    - `?color=yellow|blue|pink|green|purple|gray` - 색상 필터링
    - `?author_id=1` - 작성자 ID 필터링
    - `?from_date=2024-01-01` - 시작일 필터링
    - `?to_date=2024-12-31` - 종료일 필터링
    - `?is_locked=true|false` - 잠금 여부 필터링
- `retrieve()` - 포스트잇 상세 조회 (권한에 따라 조회 제한)
- `create()` - 포스트잇 생성 (실무자 이상, 작성자 자동 설정)
- `update()` - 포스트잇 수정 (실무자 이상, 본인 또는 관리자, 잠긴 메모는 작성자/관리자만)
  - 부분 수정(PATCH) 지원
- `destroy()` - 포스트잇 물리 삭제 (실무자 이상, 본인 또는 관리자)
- `update_position()` - 위치 빠른 업데이트 (x, y 좌표만 수정, 드래그 시 사용)
- `bulk_update()` - 다중 선택 일괄 업데이트
  - `note_ids`: 업데이트할 메모 ID 목록
  - `x_offset`, `y_offset`: 위치 이동 오프셋
  - `color`: 일괄 색상 변경
  - `importance`: 일괄 중요도 변경
  - `is_locked`: 일괄 잠금 상태 변경
- `by_viewport()` - 뷰포트 영역 내 메모만 조회 (성능 최적화)
  - `?x_min=0&x_max=1000&y_min=0&y_max=800`

### TagViewSet
- `list()` - 태그 목록 조회 (전체 사용자)
- `retrieve()` - 태그 상세 조회
- `create()` - 태그 생성 (실무자 이상)
  - name: 태그명 (필수, 고유)
  - color: 색상 코드 (선택, hex 형식)
- `update()` - 태그 수정 (실무자 이상)
  - 부분 수정(PATCH) 지원
- `destroy()` - 태그 물리 삭제 (관리자만 가능)

## 권한 정책
- **게스트 (role_level=0)**: 조회만 가능 (본인 메모)
- **실무자 (role_level=1)**: 본인 메모 생성/수정/삭제, 태그 생성/수정
- **관리자 (role_level=2)**: 모든 메모 조회/수정/삭제, 태그 삭제

## 특수 기능
- **ULID 기반 식별**: note_uid로 비즈니스 식별자 자동 생성
- **무한 캔버스**: x, y 좌표로 자유로운 배치
- **드래그 & 리사이즈**: width, height 조정 가능
- **레이어 관리**: z_index로 겹침 순서 제어
- **메모 잠금**: is_locked로 편집 제한
- **태그 시스템**: 다대다 관계로 메모 분류
- **뷰포트 최적화**: 화면에 보이는 메모만 조회
- **일괄 작업**: 여러 메모 동시 수정/이동
