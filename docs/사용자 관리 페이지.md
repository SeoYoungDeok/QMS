## 1. 페이지 개요
- **페이지명**: 사용자 관리 (User Management)  
- **목적**: QMS에 등록된 사용자 계정을 조회·수정·관리  
- **특징**:  
  - 관리 권한(role_level ≥ 2) 이상만 접근 가능  
  - 사용자 정보, 권한 레벨, 계정 상태를 통합 관리  
  - 삭제는 논리적 삭제(soft delete)로 처리  \
  - 감사 로그(Audit Log) 기록 및 로그인 실패 횟수 관리

---

## 2. 주요 기능

### 2.1 사용자 목록 조회
- 전체 사용자 목록 테이블 표시  
- 검색/필터 기능  
  - 이름, 부서, 직급, 권한 레벨, 계정 상태  

### 2.2 사용자 상세 정보 보기
- 특정 사용자 클릭 시 팝업/상세 페이지에서 상세 정보 확인  
  - 아이디, 이름, 부서, 직급, 핸드폰 번호  
  - 권한 레벨(role_level)  
  - 계정 상태(status)  
  - 가입일, 최종 수정일  
  - 로그인 실패 횟수  

### 2.3 사용자 정보 수정
- 관리자가 다음 정보 수정 가능:  
  - 부서, 직급, 핸드폰 번호  
  - 권한 레벨 변경 (게스트 ↔ 실무자 ↔ 관리자)  
  - 계정 상태 변경 (활성, 잠금, 정지, 삭제 등)  

### 2.4 계정 상태 관리
- 상태값 예시:  
  - **active**: 정상 로그인 가능  
  - **locked**: 로그인 실패 5회 이상 → 계정 잠금  
  - **suspended**: 관리자가 직접 일시 정지  
  - **deleted**: 논리적 삭제 (로그인 불가, 데이터 참조는 유지)  

### 2.5 사용자 추가/삭제
- 관리자가 직접 사용자 신규 등록 가능  
- 삭제 시 DB 레코드는 유지하고 `status = deleted` 로 업데이트  

### 2.6 비밀번호 초기화
- 관리자가 임의로 특정 사용자 비밀번호 초기화 가능  
- 임시 비밀번호 발급 → 사용자 최초 로그인 시 변경 요구  

### 2.7 감사 로그 관리
- 모든 주요 이벤트 기록  
  - 로그인 성공/실패  
  - 권한 변경  
  - 사용자 추가/삭제  
  - 계정 상태 변경  
  - 비밀번호 초기화 

---

## 3. 화면 레이아웃

### 사용자 관리 메인 화면
- **상단**: 검색/필터 바 (부서, 직급, 권한, 상태)  
- **중앙**: 사용자 목록 테이블  
  - 컬럼: ID, 아이디, 이름, 부서, 직급, 핸드폰, 권한 레벨, 상태, 가입일, 관리 버튼  
- **우측/하단**: "신규 사용자 추가" 버튼  

### 사용자 상세 관리 팝업/페이지
- 기본정보 표시 (아이디, 이름, 부서, 직급, 핸드폰 번호)  
- 권한 레벨 변경 Dropdown  
- 계정 상태 변경 Dropdown  
- 비밀번호 초기화 버튼  
- 저장/취소 버튼  
- 감사 로그 보기 버튼 (해당 사용자 이벤트 이력 확인) 

---

## 4. 데이터베이스 설계

### 4.1 기존 테이블
- **기존 테이블명**: `users`  
- 기존 테이블은 회원가입/로그인에서 정의한 내용을 그대로 사용  
- 계정 삭제는 논리적 삭제 방식 (`status = deleted`)  

### 4.2 감사 로그 테이블: `audit_logs`
| 컬럼명       | 타입         | 설명 |
|--------------|--------------|------|
| id           | BIGINT (PK)  | 로그 ID |
| user_id      | BIGINT (FK)  | 작업 수행자 ID |
| action       | VARCHAR(100) | 수행한 작업 (예: LOGIN_SUCCESS, LOGIN_FAILED, CREATE_USER, DELETE_USER, RESET_PASSWORD 등) |
| target_id    | BIGINT       | 대상 리소스 ID (해당되는 경우) |
| details      | TEXT         | 상세 정보 (변경 전/후 값, 실패 사유 등) |
| ip_address   | VARCHAR(50)  | 작업 발생 IP |
| created_at   | DATETIME     | 이벤트 발생 시각 |

---

## 5. API 요구사항

### 5.1 사용자 목록 조회
- **Endpoint**: `GET /api/users`  
- **Query Params**: `?department=품질관리부&role_level=1&status=active`  
- **Response**
```json
[
  {
    "id": 1,
    "username": "hong123",
    "name": "홍길동",
    "department": "품질관리부",
    "position": "대리",
    "phone_number": "010-1234-5678",
    "role_level": 1,
    "status": "active",
    "created_at": "2025-08-16",
    "last_login_at": "2025-08-15 10:23:00"
  }
]
```

### 5.2 사용자 상세 조회
- **Endpoint**: `GET /api/users/{id}`  

### 5.3 사용자 정보 수정
- **Endpoint**: `PUT /api/users/{id}`  
- **Request**
```json
{
  "department": "연구소",
  "position": "과장",
  "phone_number": "010-2222-3333",
  "role_level": 1,
  "status": "active"
}
```

### 5.4 사용자 추가
- **Endpoint**: `POST /api/users` (관리자 전용)  
- **Request**
```json
{
  "username": "manager01",
  "password": "InitPass@123",
  "name": "김관리",
  "department": "품질보증팀",
  "position": "과장",
  "phone_number": "010-5555-6666",
  "role_level": 2
}
```

### 5.5 사용자 삭제
- **Endpoint**: `DELETE /api/users/{id}`  
- **처리 방식**: DB 레코드는 유지하고 `status = deleted` 로 업데이트  

### 5.6 비밀번호 초기화
- **Endpoint**: `POST /api/users/{id}/reset-password`  
- **Response**
```json
{
  "message": "임시 비밀번호가 발급되었습니다.",
  "temporary_password": "Temp@1234"
}
```

### 5.7 로그인 실패 처리
- 실패 시:  
  - `failed_attempts += 1`, `last_failed_at = NOW()`  
  - `failed_attempts >= 5` → `status = locked` 업데이트  
  - `audit_logs` 에 `LOGIN_FAILED` 이벤트 기록  

### 5.8 로그인 성공 처리
- 성공 시:  
  - `failed_attempts = 0` 초기화  
  - `last_login_at = NOW()` 업데이트  
  - `audit_logs` 에 `LOGIN_SUCCESS` 기록  

### 5.9 사용자 삭제
- `status = deleted` 업데이트  
- `audit_logs` 에 `DELETE_USER` 기록  

### 5.10 권한 변경
- `audit_logs` 에 `UPDATE_ROLE` 기록 (변경 전/후 값 저장) 

---

## 6. 권한 정책
- **게스트(role_level=0)**  
  - QMS에서 읽기(Read) 기능만 가능  
  - CRUD 불가 (게시물/데이터 생성·수정·삭제 불가)  

- **실무자(role_level=1)**  
  - QMS 모든 기능에 대해 CRUD 가능  
  - 단, 관리자 페이지 접근 불가  

- **관리자(role_level=2)**  
  - 모든 기능 사용 가능 (QMS 기능 + 관리자 페이지 포함)  
  - 사용자 관리(권한 변경, 계정 상태 변경, 삭제, 초기화) 가능  

---

## 7. 비기능 요구사항
- **보안**:  
  - 관리자 기능은 반드시 JWT 인증 + role_level 확인 필요  
- **감사 로그**:  
  - 사용자 추가, 삭제, 권한 변경, 비밀번호 초기화 이벤트 기록  
- **응답속도**: 목록 조회 2초 이내 (페이징 처리 필수)  
