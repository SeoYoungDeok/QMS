## 1) 페이지 개요
- **페이지명:** 대시보드 (Quality Dashboard)
- **영역 구성:** 상단 KPI 카드(월별/연간) → 중단 월별 차트(불량율/유형/원인) → 하단 주요 품질 일정

---

## 2) 상단 — KPI 카드

### 2.1 KPI 목록
- 불량율 (defect_rate) — 표시 기본 단위: `%` (토글로 ppm)
- F-COST (f_cost) — `KRW`
- 고객 불만 건수 (complaints) — `count`

### 2.2 카드 유형 (KPI별 **2장** 구성)
1) **월별 실적 카드 (Monthly Actual + MoM)**
   - 본문 값: `A_m` (선택/현재 월 실적)
   - 보조 값: **이전 달 대비 증감율(MoM)** = `((A_m − A_{m-1}) / max(A_{m-1}, ε)) × 100`
   - 추가 표기(옵션): 월 **목표대비 달성률** 배지 (Small)
     - 월 목표 정의는 2.3 참고

2) **연간 누적 카드 (YTD Cumulative)**
   - 본문 값: `YTD(m)` — 1월부터 `m`월까지 누적 실적
   - 보조 값: **연간 목표 대비 진행률(%)** 또는 상태 배지
     - 진행률 = `YTD(m) / YTD_Target(m) × 100`

> 카드 하단에는 최근 6~12개월 미니 스파크라인(월별 실적)을 동일하게 지원합니다.

### 2.3 목표 정규화 규칙
- **불량율(defect_rate)**  
  - *월 목표*: 연간 목표 `%`를 **월별 동일 기준**으로 사용 (수준 목표)  
  - *YTD 목표*: **평균 기반**  
    - `YTD_Target(m) = AnnualTarget_%`  
    - `YTD(m)` 계산시 월별 불량율의 **가중 평균**(분모=월별 생산수량)이 있는 경우 적용 권장  
      - 예: `YTD_% = (Σ 불량수량) / (Σ 생산수량) × 100`
- **F-COST(f_cost)**  
  - *월 목표*: `AnnualTarget / 12`  
  - *YTD 목표*: `AnnualTarget × (m / 12)`  
  - `YTD(m)` = 1~m월 **월별 비용 합**
- **고객 불만 건수(complaints)**  
  - *월 목표*: `AnnualTarget / 12` (표시 시 반올림)  
  - *YTD 목표*: `AnnualTarget × (m / 12)`  
  - `YTD(m)` = 1~m월 **월별 건수 합**

### 2.4 단위 정규화
- 불량율 표시 단위는 **%** 기준. `ppm` 토글 시
  - `% → ppm = % × 10,000`
  - `ppm → % = ppm ÷ 10,000`

---

## 3) 중단 — 월별 차트 섹션 (종전과 동일)
- **월별 불량율(Line)**: 실적% vs 목표% (최근 12개월)
- **불량유형(Donut)**: D01~D07 분포 (월 기준, 건수/금액 토글)
- **발생원인(6M Donut)**: Material/Machine/Man/Method/Measurement/Environment/Other (월 기준, 건수/금액 토글)

---

## 4) 하단 — 주요 품질 일정 (종전과 동일)
- 향후 14일 `quality` 일정 카드/리스트 표시 (중요도 배지)

---

## 5) 데이터 소스 & API (개정된 상단 카드 계약)

### 5.1 상단 KPI — 월별 & YTD 통합 응답
`GET /api/dashboard/kpis?year=2025&month=09`

**응답 예시**
```json
{
  "year": 2025,
  "month": 9,
  "kpis": {
    "defect_rate": {
      "monthly": {
        "actual_percent": 0.90,
        "prev_percent": 1.20
      },
      "ytd": {
        "actual_percent": 0.95,
        "annual_target_percent": 1.00
      }
    },
    "f_cost": {
      "monthly": {
        "actual": 8000000,
        "prev": 9000000
      },
      "ytd": {
        "actual": 72000000,
        "annual_target": 120000000
      }
    },
    "complaints": {
      "monthly": {
        "actual": 7,
        "prev": 9
      },
      "ytd": {
        "actual": 58,
        "annual_target": 84
      }
    }
  }
}
```

**프론트 계산식**
- `MoM% = ((monthly.actual − monthly.prev) / max(monthly.prev, ε)) × 100`
- **월 목표**  
  - defect_rate: `monthly_target_% = annual_target_%`  
  - f_cost/complaints: `monthly_target = annual_target × (1/12)`
- **YTD 목표**  
  - defect_rate: `ytd_target_% = annual_target_%` (가중 평균 기준)  
  - f_cost/complaints: `ytd_target = annual_target × (month / 12)`
- **진행률**  
  - defect_rate: `ytd_progress_% = (ytd.actual_% / ytd_target_%) × 100`
  - f_cost/complaints: `ytd_progress_% = (ytd.actual / ytd_target) × 100`

> 서버는 `kpi_targets(year, kpi_type, target_value, unit)`을 사용하여 목표값을 조회하고, 월/연 누적은 원천 실적에서 합산(또는 가중 평균)해 제공합니다.

---

## 6) UX / UI 디테일 (카드)

### 6.1 레이아웃
- **1행**: KPI별 **월별 실적 카드 3장** (불량율/F-COST/불만) — 각 카드에 **MoM% 배지**  
- **2행**: KPI별 **연간 누적(YTD) 카드 3장** — 각 카드에 **YTD 진행률% 배지**

### 6.2 카드 구성 요소
- 헤더: KPI 이름 + 단위 배지 (%, ppm 토글 버튼은 불량율 카드에 제공)
- 메인 값: 월별 실적 or YTD 누적 값
- 서브 값/배지:
  - 월별 카드: `MoM +x.x%` 또는 `−x.x%` (아이콘 ↑/↓, 0분모 보호)
  - YTD 카드: `진행률 yyy%` (목표 대비 상태 색상: 그린/옐로/레드)
- 푸터: 미니 스파크라인(최근 12개월 실적)

---

## 7) 테스트 체크리스트 (추가/변경)
- 월별 카드 **MoM 계산** 경계값(이전월 0, 음수 금지) 검증
- YTD 누적/목표 대비 **진행률 계산** 정확성
- 불량율 **가중 평균 YTD** 검증(월별 생산량 변동 시)
- 불량율 %↔ppm 토글 즉시 반영
- 1~2행 카드 레이아웃 반응형(데스크톱 3열, 모바일 1열) 확인

