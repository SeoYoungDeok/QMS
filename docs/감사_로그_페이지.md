# 감사 로그 페이지

## 개요
시스템의 모든 사용자 활동 이력을 조회하고 추적할 수 있는 관리 페이지입니다. 보안 감사 및 활동 추적을 위한 필수 기능입니다.

## 페이지 경로
- `/audit-logs`

## 접근 권한
- **실무자** 이상: 자신의 활동 로그만 조회 가능
- **관리자**: 모든 사용자의 활동 로그 조회 가능

## 주요 기능

### 1. 감사 로그 조회
- **로그 목록 표시**: 최신 순으로 감사 로그 목록 표시
- **상세 정보**: 각 로그의 상세 정보 확인
  - 발생 시각 (년-월-일 시:분:초)
  - 사용자명
  - 수행한 액션
  - IP 주소
  - 대상 리소스 ID
  - 상세 정보

### 2. 검색 및 필터링
- **액션 타입 필터**: 특정 액션 유형만 조회
  - 로그인 성공/실패
  - 사용자 관리 (추가/수정/삭제)
  - 실적 관리 (등록/수정/삭제)
  - 부적합 관리 (등록/수정/삭제)
  - 일정 관리 (등록/수정/삭제)
  - 기타 시스템 활동
- **사용자명 검색**: 특정 사용자의 활동만 필터링
- **날짜 범위 검색**: 시작일과 종료일 지정하여 기간별 조회
- **상세 검색**: IP 주소, 상세 정보 등으로 검색
- **검색 초기화**: 모든 필터를 초기화하고 전체 로그 조회

### 3. 로그 상세 보기
- **모달 팝업**: 클릭 시 상세 정보를 모달로 표시
- **전체 정보**: 로그의 모든 필드를 읽기 쉬운 형태로 표시
- **액션 배지**: 액션 타입별로 색상이 다른 배지 표시
  - 성공 (초록색)
  - 실패/삭제 (빨간색)
  - 생성 (파란색)
  - 수정 (회색)

## 화면 구성

### 헤더 영역
- 페이지 제목: "시스템 감사 로그"
- 페이지 설명
- 현재 사용자 정보 및 권한 표시

### 검색 필터 영역
```
[액션 타입 ▼] [사용자명 입력] [상세 검색]
[시작 날짜]    [종료 날짜]
[검색 버튼]    [초기화 버튼]
```

### 로그 목록 테이블
| 발생 시각 | 사용자 | 액션 | IP 주소 | 대상 ID | 상세 | 동작 |
|-----------|--------|------|---------|---------|------|------|
| 2025-01-15 10:30:25 | admin | 로그인 성공 | 192.168.1.1 | - | 로그인 성공 | [상세] |

## API 엔드포인트

### 감사 로그 조회
```
GET /api/audit/logs/
```

**쿼리 파라미터:**
- `action`: 액션 타입 필터
- `username`: 사용자명 검색 (부분 일치)
- `date_from`: 시작 날짜 (YYYY-MM-DDTHH:MM:SS)
- `date_to`: 종료 날짜 (YYYY-MM-DDTHH:MM:SS)
- `search`: 전체 텍스트 검색 (IP, 상세 정보)
- `ordering`: 정렬 기준 (기본: -created_at)

**응답 예시:**
```json
[
  {
    "id": 1,
    "user_id": 1,
    "username": "admin",
    "action": "LOGIN_SUCCESS",
    "action_display": "로그인 성공",
    "target_id": null,
    "details": "로그인 성공",
    "ip_address": "192.168.1.1",
    "created_at": "2025-01-15T10:30:25.123456Z"
  }
]
```

## 액션 타입 목록

### 인증 관련
- `LOGIN_SUCCESS`: 로그인 성공
- `LOGIN_FAILED`: 로그인 실패
- `SIGNUP`: 회원가입

### 사용자 관리
- `CREATE_USER`: 사용자 추가
- `UPDATE_USER`: 사용자 수정
- `DELETE_USER`: 사용자 삭제
- `RESET_PASSWORD`: 비밀번호 초기화
- `UPDATE_ROLE`: 권한 변경
- `UPDATE_STATUS`: 계정 상태 변경

### 실적 관리
- `CREATE_PERFORMANCE`: 실적 등록
- `UPDATE_PERFORMANCE`: 실적 수정
- `DELETE_PERFORMANCE`: 실적 삭제

### 부적합 관리
- `CREATE_NONCONFORMANCE`: 부적합 등록
- `UPDATE_NONCONFORMANCE`: 부적합 수정
- `DELETE_NONCONFORMANCE`: 부적합 삭제

### 일정 관리
- `CREATE_SCHEDULE`: 일정 등록
- `UPDATE_SCHEDULE`: 일정 수정
- `DELETE_SCHEDULE`: 일정 삭제

## 보안 고려사항

### ⚠️ 접근 제어
- **읽기 전용**: 감사 로그는 조회만 가능하며 생성/수정/삭제 불가
- **권한 기반 필터링**: 
  - 관리자: 모든 로그 조회
  - 일반 사용자: 자신의 로그만 조회
- **인증 필수**: 로그인한 사용자만 접근 가능

### 🔒 데이터 보안
- **민감 정보 보호**: 비밀번호 등 민감한 정보는 로그에 기록하지 않음
- **IP 추적**: 모든 활동의 IP 주소 기록
- **변조 방지**: 로그 데이터는 수정/삭제 불가능

### ⚠️ 알려진 이슈 해결
1. **레이아웃 문제**: `ml-64` 클래스를 추가하여 사이드바 영역 확보
2. **관리자 표시**: `user.role_display` 사용하여 올바른 역할 표시
3. **권한 체크**: 백엔드에서 `role_level >= 2`로 관리자 확인

### 📊 성능 최적화
- **인덱싱**: created_at, user_id, action 필드에 인덱스 적용
- **페이지네이션**: 대용량 로그 처리를 위한 페이지네이션 고려
- **쿼리 최적화**: select_related를 통한 N+1 쿼리 방지

## 사용 시나리오

### 시나리오 1: 보안 감사
1. 관리자가 감사 로그 페이지 접속
2. "로그인 실패" 액션으로 필터링
3. 최근 1주일간의 실패한 로그인 시도 확인
4. 의심스러운 IP 주소 식별

### 시나리오 2: 데이터 변경 추적
1. 중요한 데이터가 수정됨
2. 관리자가 해당 날짜/시간으로 필터링
3. 누가, 언제, 무엇을 수정했는지 확인
4. 필요시 원인 파악 및 조치

### 시나리오 3: 사용자 활동 모니터링
1. 특정 사용자의 활동 확인 필요
2. 사용자명으로 검색
3. 해당 사용자의 모든 활동 이력 조회
4. 비정상적인 활동 패턴 식별

## 기술 스택
- **Backend**: Django REST Framework
- **Frontend**: Next.js 15, React, TypeScript
- **Styling**: Tailwind CSS
- **Components**: 커스텀 UI 컴포넌트 (Card, Button, Input, Select, Badge, Modal)
- **Icons**: Lucide React
- **Notifications**: Sonner (Toast)

## 향후 개선사항
- [ ] 페이지네이션 구현
- [ ] 로그 내보내기 (CSV, Excel)
- [ ] 실시간 로그 모니터링 (WebSocket)
- [ ] 로그 통계 및 대시보드
- [ ] 로그 보관 정책 설정
- [ ] 고급 검색 필터 (정규식 지원)

