# 포스트잇 보드(Sticky Notes Board) 페이지 기능 명세서

메모(포스트잇)를 무한 캔버스 위에 자유롭게 배치/편집/검색/확대·이동할 수 있는 페이지의 기능·데이터·API를 정의합니다.  
(작성자 FK는 **기존 `users` 테이블**을 참조, 중요도는 **일정 관리 페이지와 동일한 낮음/중간/높음**을 사용)

---

## 1) 페이지 개요
- **페이지명:** 포스트잇 보드 (Sticky Notes Board)
- **목적:** 개인/팀의 아이디어·이슈·TODO 등을 포스트잇 형태로 시각 정리하고, 태그·중요도·색상으로 분류/강조
- **접근 권한(권장):**
  - 게스트(0): 읽기 전용(보드 조회만)
  - 실무자(1): 메모 생성/수정/삭제, 드래그/리사이즈
  - 관리자(2): 모든 메모 관리, 보드 설정(색상 팔레트/락/정렬 정책 등)
- **감사 로그(권장):** `CREATE_NOTE`, `UPDATE_NOTE`, `DELETE_NOTE`

---

## 2) 데이터 모델 (영문 컬럼)

### 2.1 `sticky_notes` — 포스트잇 본문
| Column | Type | Description |
|---|---|---|
| id | BIGINT PK AI | Internal PK |
| note_uid | CHAR(26) UNIQUE | ULID business key |
| author_id | BIGINT FK→users.id | 작성자 |
| content | TEXT | 메모 내용(마크다운 간단 지원 옵션) |
| importance | ENUM('low','medium','high') | 중요도(낮음/중간/높음) |
| color | VARCHAR(20) | 메모지 색상 키(예: 'yellow','blue','pink','green','purple','gray') |
| x | FLOAT | 캔버스 상 X 좌표(px) |
| y | FLOAT | 캔버스 상 Y 좌표(px) |
| width | FLOAT | 메모 가로(px) |
| height | FLOAT | 메모 세로(px) |
| z_index | INT | 겹침 순서 |
| rotation | FLOAT NULL | 회전 각도(도, 선택) |
| is_locked | TINYINT(1) DEFAULT 0 | 잠금(드래그/편집 방지) |
| created_at | DATETIME | 생성 |
| updated_at | DATETIME | 수정 |

### 2.2 `tags` — 태그 마스터
| Column | Type               | Description     |
| ------ | ------------------ | --------------- |
| id     | BIGINT PK AI       | Internal PK     |
| name   | VARCHAR(50) UNIQUE | 태그명(소문자 정규화 권장) |
| color  | VARCHAR(20) NULL   | 태그 색상(선택)       |

### 2.3 `note_tags` — 다대다 매핑
| Column | Type | Description |
|---|---|---|
| note_id | BIGINT FK→sticky_notes.id | 메모 |
| tag_id | BIGINT FK→tags.id | 태그 |
| PK | (note_id, tag_id) | 복합 PK |

**인덱스/옵션**
- `idx_notes_author` (`author_id`), `idx_notes_pos` (`x`,`y`), `idx_notes_importance` (`importance`)
- 전체 텍스트 검색을 위해 `content`에 **FULLTEXT**(MySQL) 또는 GIN/TSVECTOR(Postgres) 권장

---

## 3) 요구 기능 매핑

1) **메모 자유 배치(드래그 이동)**  
   - 캔버스 위에서 메모를 포인터로 드래그 → `x,y` 업데이트(서버 패치).  
   - 다중 선택 이동(Shift+드래그), 스냅(격자/가이드) 옵션.

2) **새 메모 추가, 삭제, 수정**  
   - 추가: 더블클릭/플러스 버튼/단축키(`N`) → 생성 모달 없이 인라인 생성 가능.  
   - 수정: 더블클릭 또는 `Enter`로 편집모드 → 저장 시 `content`/`size` 등 PATCH.  
   - 삭제: 단건 삭제(확인 모달) / 멀티 선택 삭제. **정책: 물리 삭제**.

3) **메모지 색상 선택**  
   - 팔레트(6~8색 기본) + 커스텀 HEX 입력 옵션(권한 설정에 따름).

4) **중요도에 따른 강조 표현**  
   - 배지/테두리/그라데이션 강조.  
   - 리스트/검색 결과에서도 중요도 배지(🟢 낮음 / 🟡 중간 / 🔴 높음).

5) **메모지 크기 조절(리사이즈)**  
   - 코너/엣지 핸들로 `width,height` 변경.  
   - 최소/최대 크기 제한(예: 120×100 ~ 800×600 px).

6) **검색 및 필터링**  
   - 키워드(풀텍스트), 태그(다중), 중요도, 색상, 작성자, 기간(생성/수정) 필터.  
   - 정렬 옵션: 최신/중요도/가나다/좌표 등.

7) **줌/패닝(무한 캔버스 느낌)**  
   - 마우스 휠/핀치 줌(0.25×~3×), 스페이스+드래그로 패닝.  
   - 현재 뷰포트 상태는 클라이언트 상태로 유지, 사용자별 **로컬 저장** 또는 서버 `user_preferences`에 보관 옵션.

**부가 기능(권장)**  
- Z-Order 제어(앞/뒤로 보내기), 그룹화(멀티 선택 박스), 정렬 도구(가로정렬/세로정렬/균등간격).  
- 히스토리(Undo/Redo 20단계).  
- 메모 잠금/해제(`is_locked`).

---

## 4) UX / UI

### 4.1 캔버스 영역
- 무한 캔버스(가상 무한): 기본 원점(0,0) 기준, 뷰포트 중앙 시작.  
- 우측 하단 **미니맵**(현재 뷰포트/메모 분포).  
- 상단 툴바: 새 메모, 검색, 필터(태그/중요도/색상/작성자), 정렬, 되돌리기/재실행, 줌 레벨 표시.

### 4.2 메모 카드
- 헤더: 태그 칩(다중), 중요도 배지, 컨텍스트 메뉴(잠금/복제/앞으로/뒤로/삭제).  
- 본문: 리치 텍스트(볼드/리스트/체크박스) 최소 지원.  
- 푸터: 작성자 아바타, 타임스탬프(업데이트 상대 시각).

### 4.3 검색 패널
- 좌측 사이드 패널 토글. 즉시 필터링 & 하이라이트.  
- 검색 결과 클릭 시 해당 메모로 카메라 이동(스무스 스크롤/줌).

---

## 5) API 설계

### 5.1 메모
- `POST /api/sticky-notes`
  ```json
  { "content":"메모", "importance":"medium", "color":"yellow", "x":200, "y":120, "width":220, "height":160, "z_index":10, "tag_ids":[1,3] }
  ```
- `GET /api/sticky-notes?query=&tag_ids=1,3&importance=high&color=yellow&author_id=12&from=2025-09-01&to=2025-09-30&sort=updated_at_desc`
- `PATCH /api/sticky-notes/{id}` — 부분 수정(위치/크기/내용/색상/중요도/태그)
- `PATCH /api/sticky-notes/{id}/position` — `{ "x":123.4, "y":567.8, "z_index": 21 }`
- `DELETE /api/sticky-notes/{id}` — 물리 삭제

### 5.2 태그
- `POST /api/tags` — 새 태그 생성
- `GET /api/tags` — 태그 목록
- `DELETE /api/tags/{id}` — 태그 삭제(참조 무결성 체크)

### 5.3 실시간 동기화(선택)
- WebSocket/Server-Sent Events: `ws://.../sticky-notes`  
  - 이벤트: `note.created/updated/deleted`, `note.position`(스로틀링), `tag.created/deleted`  
  - 잠금 충돌 방지: 편집 진입 시 `note.locked(author_id)` 브로드캐스트

---

## 6) 클라이언트 동작/성능

- **드래그/리사이즈 최적화:** 16ms 이하 루프, 위치 업데이트는 **로컬 적용 → 스로틀링 PATCH(100~250ms)**.  
- **가상화 렌더링:** 뷰포트 밖 메모는 비가시 영역 처리.  
- **이미지/파일 첨부(옵션):** 별도 `attachments` 테이블 고려.  
- **오프라인 내구성:** 낙관적 업데이트 + 실패 시 롤백/토스트.  
- **접근성:** 키보드 이동(화살표), 스크린리더 레이블, 대비 모드.

---

## 7) 테스트 체크리스트

- 드래그/리사이즈 좌표/크기 저장 정확성(줌 상태에서도 좌표 변환 OK)  
- 새 메모/수정/삭제 API 흐름 및 실시간 반영(옵션)  
- 중요도 강조 렌더링 및 필터/검색 동작  
- 태그 CRUD 및 다대다 매핑(note_tags) 무결성  
- 대량 메모(≥2,000개) 성능: 줌/패닝 프레임 유지(> 50fps), API 페이지네이션 대응  
- 권한별 제약: 잠금 메모 편집 불가, 게스트는 읽기 전용

---

## 8) 한글 - 영문 대응표
| 한글 필드명 | 영문 컬럼명 |
|---|---|
| 작성자 | author_id |
| 메모 내용 | content |
| 중요도 | importance (`low`/`medium`/`high`) |
| 색상 | color |
| X좌표 | x |
| Y좌표 | y |
| 너비 | width |
| 높이 | height |
| 쌓임 순서 | z_index |
| 회전 | rotation |
| 잠금 여부 | is_locked |
| 생성시각 | created_at |
| 수정시각 | updated_at |
| 태그명 | tags.name |

**끝.**
