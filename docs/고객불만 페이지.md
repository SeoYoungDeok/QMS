# 고객 불만 페이지 기능 명세서 — 통합본

## 1) 페이지 개요
- **페이지명:** 고객 불만 (Customer Complaint, CCR)  
- **목적:** 고객 불만 접수·조치 이력을 등록/관리하고, 불량유형·발생원인(6M)과 연계 분석  
- **접근 권한:**  
  - 게스트(0): 읽기 전용  
  - 실무자(1): 등록/수정/삭제(본인 등록분)  
  - 관리자(2): 전체 관리  

---

## 2) 데이터 모델 (영문 컬럼 정규화)

### 2.1 `customer_complaints`
| Column | Type | Description |
|---|---|---|
| id | BIGINT PK AI | Internal PK |
| ccr_uid | CHAR(26) UNIQUE | ULID business key |
| occurrence_date | DATE | 고객 불만 발생일자 |
| ccr_no | VARCHAR(50) | 고객 불만 발행 번호 |
| vendor | VARCHAR(100) | 업체명 |
| product_name | VARCHAR(100) | 품명 |
| control_no | VARCHAR(100) | 관리번호 |
| defect_qty | INT | 부적합 수량 |
| unit_price | DECIMAL(18,2) | 단가 |
| total_amount | DECIMAL(18,2) | 합계 = defect_qty × unit_price |
| complaint_content | TEXT | 고객 불만 내용 |
| action_content | TEXT | 조치 내용 |
| defect_type_code | VARCHAR(20) | 불량유형 코드 (참조: defect_types) |
| cause_code | VARCHAR(20) | 발생원인 코드 (참조: defect_causes) |
| created_by | BIGINT FK→users.id | 작성자 |
| created_at | DATETIME | 생성 |
| updated_at | DATETIME | 수정 |

### 2.2 `defect_types` & `defect_causes`
- **불량유형(`defect_types`)**: 부적합 페이지와 동일 (D01~D07)  
- **발생원인(`defect_causes`)**: 부적합 페이지와 동일 (M1.1~M7.1, 6M Category 포함)  

---

## 3) 주요 기능
- **등록(Create):** 필수값 검증, 합계 자동계산, 코드 무결성 확인 후 저장  
- **조회(Read):** 기간/업체/품명/코드 기반 검색 + 페이징  
- **수정(Update):** 실무자=본인, 관리자=전체  
- **삭제(Delete):** 물리 삭제 (감사 로그 기록)  

---

## 4) UX / UI
- 등록/수정 모달:  
  - 기본정보(발생일, CCR NO, 업체, 품명, 관리번호)  
  - 수량/단가 입력 시 합계 자동 계산(readonly)  
  - 고객 불만 내용, 조치 내용 입력 필드  
  - 불량유형/발생원인 드롭다운 (코드+설명 표시)  
- 목록: 주요 필드 표시 + 조치 여부 배지  
- 상세 모달: 전체 내역 표시  

---

## 5) API 설계
- `POST /api/customer-complaints` — 등록  
- `GET /api/customer-complaints` — 목록/검색  
- `GET /api/customer-complaints/{id}` — 상세  
- `PUT /api/customer-complaints/{id}` — 수정  
- `DELETE /api/customer-complaints/{id}` — 물리 삭제  

---

## 6) 오류 처리
- 400 validation_error (필수값 누락/유효성 실패)  
- 401 unauthorized (JWT 누락/만료)  
- 403 forbidden (권한 부족)  
- 404 not_found (데이터 없음)  
- 500 server_error  

---

## 7) 한글 - 영문 대응표
| 한글 필드명 | 영문 컬럼명 |
|---|---|
| 발생일 | occurrence_date |
| CCR NO | ccr_no |
| 업체명 | vendor |
| 품명 | product_name |
| 관리번호 | control_no |
| 부적합수량 | defect_qty |
| 금액 | unit_price |
| 합계 | total_amount |
| 고객 불만 내용 | complaint_content |
| 조치 내용 | action_content |
| 불량유형 | defect_type_code |
| 발생원인 | cause_code |

---
