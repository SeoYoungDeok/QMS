# 일정 관리 페이지 기능 명세서 (v2)

## 1) 페이지 개요
- **페이지명:** 일정 관리 (Schedule Management)  
- **목적:**  
  - 품질 일정(출하검사, 수입검사, 제품출하, 감사 등)과 개인 일정(회의, 교육, 휴가 등)을 등록·조회·수정·삭제  
  - 팀/개인 단위 캘린더 가시화 및 중요도 관리(낮음/보통/높음)
- **접근 권한:**  
  - **게스트(0):** 읽기 전용  
  - **실무자(1):** **품질 일정/개인 일정 모두 등록·수정·삭제 가능**  
  - **관리자(2):** 전체 일정 관리(모든 일정 등록/수정/삭제, 소유자 무관)

> 변경 요약: 실무자도 품질 일정 등록 가능(✓), 일정은 **물리 삭제**(✓), 알림/공유 제거(✓), 시간 필드는 **필수 아님**(✓).

---

## 2) 데이터 모델 매핑

### 2.1 `schedules` (일정 테이블)
| 컬럼명 | 타입 | 설명 |
|---|---|---|
| id | BIGINT (PK, AI) | 내부 식별자 |
| schedule_uid | CHAR(26) UNIQUE | ULID 비즈니스 고유키 |
| type | ENUM(`quality`,`personal`) | 일정 유형 |
| category | VARCHAR(50) | 품질: 출하검사/수입검사/제품출하/감사 … / 개인: 회의/교육/휴가 … |
| title | VARCHAR(100) | 일정 제목 |
| description | TEXT NULL | 상세 설명 |
| importance | ENUM(`low`,`medium`,`high`) | 중요도 |
| **start_date** | DATE | **필수** (날짜) |
| **end_date** | DATE NULL | 종료 날짜(없으면 start_date와 동일 취급) |
| **start_time** | TIME NULL | **선택** |
| **end_time** | TIME NULL | **선택** |
| owner_id | BIGINT (FK→users.id) | 일정 생성자 |
| participants | JSON NULL | 참석자 id 배열(선택) |
| location | VARCHAR(100) NULL | 장소(선택) |
| created_at | DATETIME | 생성 시각 |
| updated_at | DATETIME | 수정 시각 |

**모델 규칙**
- `end_date` 미입력 시 `start_date`로 대체.
- 시간이 하나만 입력된 경우:  
  - `start_time`만 있으면 단일 시점 이벤트로 표시(또는 기본 1시간 블록 표시 정책 선택).  
  - `end_time`만 있는 입력은 허용하지 않음(검증 에러).
- `start_date,end_date`는 과거/미래 모두 허용(정책에 따라 제한 가능).

**인덱스 권장**
- `idx_schedules_date` (`start_date`,`end_date`)
- `idx_schedules_type_importance` (`type`,`importance`)
- `idx_schedules_owner` (`owner_id`)

---

## 3) 주요 기능

### 3.1 일정 등록 (Create)
- **권한:** 실무자 이상.
- **입력 필드**
  - **필수:** `type`, `category`, `title`, `importance`, `start_date`
  - **선택:** `description`, `end_date`, `start_time`, `end_time`, `location`, `participants`
- **검증**
  - `title` 1~100자.
  - `importance ∈ {low, medium, high}`.
  - 날짜 범위: `end_date`가 존재하면 `end_date ≥ start_date`.
  - 시간 범위: `start_time`과 `end_time`이 모두 존재하면 `(start_date,start_time) ≤ (end_date,end_time)`.
- **저장 후**
  - 성공 토스트 + 상세보기 링크.
  - 감사 로그: `CREATE_SCHEDULE(schedule_uid, type, category, importance, date-range)`.

### 3.2 일정 조회 (Read)
- **뷰:** 월/주/일/리스트 뷰 전환.
- **필터/검색:** 유형(품질/개인), 카테고리, 중요도, 소유자/참여자, 기간.
- **표시 규칙**
  - 중요도 배지: 🟢 낮음 / 🟡 보통 / 🔴 높음.
  - 시간 미입력 이벤트는 **종일(all-day)**로 표시(또는 날짜 블록).

### 3.3 일정 수정 (Update)
- **권한:**  
  - 실무자: 본인이 생성한 일정 수정 가능(품질/개인 모두).  
  - 관리자: 전체 수정 가능.
- **감사 로그:** `UPDATE_SCHEDULE(schedule_uid, diff)`.

### 3.4 일정 삭제 (Delete)
- **권한:**  
  - 실무자: 본인 일정 **삭제 가능**.  
  - 관리자: 전체 일정 **삭제 가능**.
- **정책:** **물리 삭제(Physical Delete)** 수행.  
  - 감사 로그: `DELETE_SCHEDULE(schedule_uid)`.

> 변경 요약: 논리 삭제(`status=deleted`) 사용하지 않음. 실제 레코드 제거.

---

## 4) UX/UI 구성 (v6 - 최종, 디자인 통일)

### 4.1 레이아웃 (부적합/고객불만 페이지와 완전 통일)
- **사이드바**: 전체 페이지에 사이드바 추가 (`ml-64`)
- **배경**: 전체 회색 배경 (`bg-gray-50`)
- **헤더**: 페이지 제목 및 설명 (배경 없음, 텍스트만 표시)
- **탭 네비게이션**: 회색 배경 (`bg-gray-100`)에 둥근 버튼 형태
  - 활성 탭: 흰색 배경 + 파란색 텍스트 + 그림자
  - 비활성 탭: 회색 텍스트
  - 4개 탭: 달력, 품질 일정 등록, 개인 일정 등록, 목록

### 4.2 품질/개인 일정 등록 탭
- **별도 등록 폼**: 품질과 개인 일정을 각각의 탭에서 등록
- 폼 레이아웃:
  - **카테고리**: 배지 형태의 라디오 버튼 (필수) ← NEW!
    - 선택된 항목: 컬러 배경(품질=파랑, 개인=보라) + 흰색 텍스트 + 그림자
    - 미선택 항목: 회색 배경 + 회색 텍스트
  - **중요도**: 배지 형태의 라디오 버튼 (필수) ← NEW!
    - 높음: 빨간색 배지
    - 보통: 노란색 배지
    - 낮음: 초록색 배지
- 일정 제목 (필수)
- 날짜 (2열):
  - 시작일 (필수)
  - 종료일 (선택)
- 시간 (2열):
  - 시작 시간 (선택)
  - 종료 시간 (선택)
- 장소 (선택)
- 상세 설명 (textarea, 선택)
- **버튼**: "품질 일정 등록" 또는 "개인 일정 등록"
- 등록 성공 시:
  - Toast 알림 표시
  - **폼 자동 초기화**
  - 목록 자동 새로고침
- 권한 없으면 등록 버튼 비활성화

### 4.3 달력 탭
- **검색 필터**: 흰색 배경으로 다른 영역과 구분 (`bg-white`, `shadow-sm`, `border`) ← NEW!
  - **기간**: 시작일 ~ 종료일 입력
  - **유형**: 배지 라디오 버튼 (전체/품질/개인) ← NEW!
    - 전체: 회색 배지
    - 품질 일정: 파란색 배지
    - 개인 일정: 보라색 배지
  - **중요도**: 배지 라디오 버튼 (전체/낮음/보통/높음) ← NEW!
    - 전체: 회색 배지
    - 낮음: 초록색 배지
    - 보통: 노란색 배지
    - 높음: 빨간색 배지
  - **검색어**: 제목, 설명, 장소 검색 (전체 너비)
  - **버튼**: 초기화 / 검색 (우측 정렬)
  - **검색 실행**: "검색" 버튼 클릭 또는 엔터키 입력 (성능 최적화)
- **달력**: 월 단위 달력 표시
  - 날짜 클릭 시 날짜 선택
  - 일정 클릭 시 상세 모달 표시

### 4.4 목록 탭
- **검색 필터**: 달력 탭과 동일한 디자인 및 기능 ← NEW!
  - 흰색 배경, 배지 라디오 버튼 디자인
  - 실시간 검색 대신 버튼/엔터 기반 검색으로 성능 이슈 방지
- 카드 형태로 일정 목록 표시
  - 제목, 유형/카테고리, **중요도 배지**, 날짜, 시간, 장소, 작성자
  - 클릭 시 **상세 모달** 오픈

### 4.5 일정 상세 모달
- 전체 필드 표시: 제목, 유형, 카테고리, 중요도, 날짜, 시간, 장소, 설명, 참석자
- 소유자/참석자, 생성/수정 시각 표시
- 권한에 따라 **수정/삭제** 버튼 노출

### 4.6 삭제 확인 모달 (통일된 디자인)
- **경고 아이콘**: AlertTriangle 아이콘 + 빨간색 배경
- **경고 메시지**: "정말로 이 일정을 삭제하시겠습니까?"
- **일정 정보 표시**: 제목, 유형, 카테고리, 시작일, 중요도
- **버튼**: 취소(outline) + 삭제(danger)
- 부적합/고객불만 삭제 모달과 동일한 디자인

### 4.7 피드백 (Toast 알림)
- **성공**: 일정 등록/수정/삭제 성공
- **오류**: API 호출 실패 시
- **정보**: 필터 초기화 등
- Sonner 라이브러리 사용 (`richColors` 활성화)

---

## 5) API 설계

### 5.1 엔드포인트
- `POST /api/schedules` — 등록  
- `GET /api/schedules` — 조회(쿼리: `from`, `to`, `type`, `category`, `importance`, `owner`, `participant`, `q`)  
- `GET /api/schedules/{id}` — 상세  
- `PUT /api/schedules/{id}` — 수정  
- `DELETE /api/schedules/{id}` — **물리 삭제**

### 5.2 요청/응답 예시

**등록 요청 (시간 미입력 예시)**
```json
POST /api/schedules
{
  "type": "quality",
  "category": "출하검사",
  "title": "A고객 출하검사",
  "importance": "high",
  "start_date": "2025-09-10",
  "description": "출하 전 최종검사",
  "location": "검사장-1"
}
```

**등록 응답**
```json
{ "ok": true, "data": { "id": 234, "schedule_uid": "01JC..." } }
```

**조회 예시**
```json
GET /api/schedules?from=2025-09-01&to=2025-09-30&type=quality&importance=high
```

**삭제 응답(물리)**
```json
{ "ok": true }
```

---

## 6) 오류 처리
- **400** `validation_error` (예: end_time만 입력, 잘못된 범위)  
- **401** `unauthorized` (JWT 누락/만료)  
- **403** `forbidden` (소유권/권한 부족)  
- **404** `not_found` (존재하지 않는 일정)  
- **409** `conflict` (동일 시간/자원 중복 정책 사용하는 경우)  
- **500** `server_error`

---

## 7) 테스트 체크리스트
- 일정 **시간 미입력** 등록/표시/수정/조회 동작 확인(종일 표시 규칙).  
- 실무자의 **품질 일정 등록/수정/삭제** 가능 여부.  
- 물리 삭제 수행 및 후속 조회 시 미노출 확인(감사 로그 기록 포함).  
- 필터: 중요도/유형/카테고리/기간/소유자/참여자 조합.  
- 시간 유효성: start/end 시간 쌍 검증, 날짜-시간 조합 경계값.  
- 캘린더 월/주/일/리스트 전환 성능 및 페이징/가상스크롤(리스트).
