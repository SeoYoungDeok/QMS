---
description: 사용자 인증, 권한 관리, 회원가입/로그인 기능을 개발하거나 사용자 관리 페이지를 구현할 때 참고
globs:
alwaysApply: false
---

## 라우트 (URL)
- `/signup/` - 회원가입 (POST)
- `/login/` - 로그인 (POST)
- `/check-username/` - 아이디 중복 체크 (GET)
- `/change-password/` - 비밀번호 변경 (POST, 인증된 사용자, 자기 자신만)
- `/users/` - 사용자 목록 조회 (GET, 관리자 전용)
- `/users/<int:pk>/` - 사용자 상세 조회 (GET)
- `/users/<int:pk>/update/` - 사용자 정보 수정 (PUT/PATCH, 관리자 전용)
- `/users/<int:pk>/delete/` - 사용자 삭제 (DELETE, 관리자 전용, 논리삭제)
- `/users/<int:pk>/reset-password/` - 비밀번호 초기화 (POST, 관리자 전용)
- `/users/<int:pk>/restore/` - 사용자 복구 (POST, 관리자 전용)
- `/users/create/` - 사용자 추가 (POST, 관리자 전용)

## 스키마 (모델)
**User 모델**: 사용자 계정 정보 관리
- `username` (CharField, 50자, 고유) - 사용자 아이디
- `password_hash` (CharField, 255자) - 해시된 비밀번호
- `name` (CharField, 50자) - 사용자 이름
- `department` (CharField, 100자) - 부서
- `position` (CharField, 50자) - 직급
- `phone_number` (CharField, 20자) - 핸드폰 번호
- `role_level` (IntegerField) - 권한 레벨 (0:게스트, 1:실무자, 2:관리자)
- `status` (CharField) - 계정 상태 (active:활성, locked:잠금, deleted:삭제)
- `failed_attempts` (IntegerField) - 로그인 실패 횟수 (5회 이상 시 자동 잠금)
- `last_failed_at` (DateTimeField) - 마지막 실패 시각
- `created_at`, `updated_at`, `last_login_at` - 타임스탬프

**주요 변경사항**:
- `suspended` 상태 제거 (활성, 잠금, 삭제만 사용)
- 권한 레벨 한글 표기: Guest→게스트, Practitioner→실무자, Admin→관리자

## 서비스 함수

### 백엔드 (Django REST Framework)
- `signup()` - 회원가입 처리, 기본 상태는 'locked'으로 설정
- `login()` - 로그인 처리, JWT 토큰 발급, 실패 시 횟수 증가 및 계정 잠금
- `check_username()` - 아이디 중복 확인
- `change_password()` - 비밀번호 변경 (자기 자신만 가능, 현재 비밀번호 확인 필요)
- `UserListView` - 사용자 목록 조회 (필터링, 검색, 정렬 지원)
- `UserDetailView` - 사용자 상세 조회 (관리자는 모든 사용자, 일반 사용자는 본인만)
- `UserUpdateView` - 사용자 정보 수정 (관리자 전용, 일반 사용자는 본인 프로필 수정 가능)
- `UserCreateView` - 사용자 추가 (관리자 전용, 기본 상태 'active'로 생성)
- `UserDeleteView` - 사용자 논리적 삭제 (관리자 전용, 자기 자신 삭제 불가, 상태를 'deleted'로 변경)
- `reset_password()` - 임시 비밀번호 발급 (관리자 전용, 12자리 랜덤 생성, 실패 횟수 초기화)
- `restore_user()` - 삭제된 사용자 복구 (관리자 전용, 삭제된 상태만 복구 가능, 복구 시 'locked' 상태로 설정, 실패 횟수 초기화)

### 프론트엔드 (React/Next.js)
- **사용자 관리 페이지** (`/admin/users`)
  - 사용자 목록 조회, 필터링 (부서, 직급, 권한, 상태)
  - 검색 기능 (이름, 아이디, 부서, 직급)
  - 토글 버튼으로 계정 상태 전환 (활성 ↔ 잠금)
  - 비밀번호 초기화 (🔑 아이콘 버튼)
  - 사용자 추가/수정/삭제/복구
  - **삭제 확인 모달**: 사용자 정보 표시, 경고 아이콘, 취소/삭제 버튼
  - **복구 확인 모달**: 사용자 정보 표시, 정보 아이콘, 취소/복구 버튼
  - **삭제된 사용자**: 수정/삭제/상태토글/비밀번호 버튼 숨김, 복구 버튼만 표시
  - 테이블: 최소 너비 지정으로 텍스트 밀림 방지, 가로 스크롤 지원
  - Toast 알림(sonner)으로 성공/실패 메시지 표시
  - 권한 레벨 한글 표시 (게스트, 실무자, 관리자)
  
- **사이드바 프로필 수정**
  - 사용자 정보 섹션 클릭으로 모달 오픈
  - 탭 기능: "정보 수정" / "비밀번호 변경"
  - 정보 수정: 부서, 직급, 핸드폰 번호 수정 가능
  - 비밀번호 변경: 현재 비밀번호, 새 비밀번호, 새 비밀번호 확인 입력
  - 비밀번호 정책: 최소 8자, 영문/숫자/특수문자 필수
  - 수정 후 AuthContext 및 localStorage 자동 업데이트

## UI/UX 개선사항
- 📊 통합 사이드바: 모든 페이지에서 일관된 네비게이션
- 🔄 상태 토글: 클릭 한 번으로 활성화/잠금 전환
- 🔔 Toast 알림: 모든 액션에 대한 실시간 피드백
- 🌐 한글화: 권한 레벨 및 상태를 한글로 표시
- 👤 셀프 서비스: 사용자가 자신의 프로필 직접 수정
- ⚠️ 확인 모달: 삭제/복구 시 사용자 정보와 함께 확인 요청
- 🔄 복구 기능: 삭제된 사용자를 복구하여 재사용 가능
- 📱 반응형 테이블: 최소 너비 지정과 가로 스크롤로 모든 화면 크기 지원

## 감사 로그 (Audit Log)
### 사용자 관리 관련 액션
- `CREATE_USER` - 사용자 추가 (관리자)
- `UPDATE_USER` - 사용자 정보 수정 (관리자)
- `DELETE_USER` - 사용자 삭제 (관리자)
- `RESTORE_USER` - 사용자 복구 (관리자) ✨ 신규
- `RESET_PASSWORD` - 비밀번호 초기화 (관리자)
- `UPDATE_ROLE` - 권한 변경 (관리자)
- `UPDATE_STATUS` - 계정 상태 변경 (관리자)
- `LOGIN_SUCCESS` - 로그인 성공
- `LOGIN_FAILED` - 로그인 실패
- `SIGNUP` - 회원가입

모든 액션은 수행자, 대상 사용자 ID, 상세 정보, IP 주소, 시각을 기록합니다.
